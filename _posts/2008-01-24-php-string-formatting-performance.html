---
layout: post
status: published
published: true
title: PHP String Formatting Performance
author:
  display_name: Judebert
  login: judebert
  email: judebert@judebert.com
author_login: judebert
author_email: judebert@judebert.com
date: 2008-01-24 20:12:17 UTC
permalink: "/progress/archives/204-PHP-String-Formatting-Performance.html"
categories:
- Web Activities
tags: []
comments:
- id: 360
  author: G. Crisp
  author_email: ''
  author_url: ''
  date: '1206390897'
  content: "Can you please share your test code?  I'm running in MAMP on OS X 10.5,
    and I'm getting the opposite results between single-quote cat and double-quote
    eval [e.g. single quote cat of 3 strings over 10,000,000 iterations takes about
    20 seconds, while double-quoted eval with the same parameters takes about 24 seconds]\r\n\r\nThanks!"
- id: 366
  author: HM2K
  author_email: php@hm2k.org
  author_url: http://www.hm2k.com/
  date: '1209378748'
  content: I'd also be interested in the code used here...
- id: 368
  author: Judebert
  author_email: ''
  author_url: http://judebert.com/
  date: '1209736714'
  content: Right, I meant to provide that.  Slipped through the cracks.  Let me just
    vet it, and I'll add it to the article!
- id: 546
  author: zawmn
  author_email: zawmn83@gmail.com
  author_url: ''
  date: '1257844536'
  content: "$a = \"Hello \";\r\n\r\n$b = \"World\";\r\n\r\n(1) $c = $a.$b;\r\n\r\n(2)
    $c = \"$a$b\";\r\n\r\nI would like to know which one is faster to concat (1) or
    (2). OR if there is another faster way to contact, let me know."
- id: 551
  author: Judebert
  author_email: ''
  author_url: http://judebert.com
  date: '1257965091'
  content: While I suspect (1) is faster, I didn't specifically test that case. Since
    the code I provided is reasonably modular, I'd recommend extending it and trying
    for yourself.  Let us know what you find!
- id: 552
  author: zawmn
  author_email: zawmn83@gmail.com
  author_url: ''
  date: '1258021713'
  content: "Yes.  No.1 is faster.\r\nWhen I test this operation 10000000, \r\n$c =
    $a.$b;  takes 4.47 sec\r\n$c = \"$a$b\"; takes 7.22 sec"
- id: 593
  author: fkaufusi
  author_email: ''
  author_url: ''
  date: '1263851587'
  content: "sprintf use to organize your code for an easy maintain and easy to read.\r\n\r\nI
    use sprintf on the query only."
excerpt_separator: <a id="extended"></a>
---
<p>I'm working on some PHP right now, and I want it as fast as possible.  Naturally, I have to output some interesting stuff; concatenated strings, with integer or floating-point values in them.
</p><p>
The question becomes: is it faster to print values that must be formatted, such as the string "\n", or integers or floating-point numbers, by:
</p>
<ol>
<li>Including them in one long double-quoted string</li>
<li>Concatenating them between multiple single-quoted strings</li>
<li>Using the heredoc format</li>
<li>Using the sprintf() function</li>
</ol>
<p>I made a quick PHP script to do the benchmark for me.  The results were interesting.</p>
<p>
  <i>Update 2008-05-02: source code!</i>
</p><a id="extended"></a><p>This test was done on a Linux server running PHP 5.2.2.  The Zend optimizer was installed.
</p><p>All calculations are done by putting the value into a variable, outstr.  Once the string is obtained, a simple print or echo can be used to output it.  This way I don't actually have to generate a lot of output in the HTML, so I can run the test online.
</p><p>
Here's a snip of the output:
</p>
<blockquote>
<p>calculating a very long string using only single-quote concatenation... 319ms.<br />calculating the same string using a large double-quoted concatenation... 259ms.<br />calculating the same string using a heredoc... 282ms.<br />calculating the same string using an sprintf()... 401ms.<br />calculating the same string using an sprintf() with positional params... 456ms.<br /></p>
<h3>Graphical comparisons</h3>
<table id="toptable" border="1">
<tr>
<th>Method (100000 iterations)</th>
<th>Percent of time out of max (456 ms)</th>
</tr>
<tr>
<td>Single quote concat</td>
<td><table width="69.956140350877%" style="background: #0000FF"><tr><td></td></tr></table></td>
</tr>

<tr>
<td>Double quote eval</td>
<td><table width="56.798245614035%" style="background: #0000FF"><tr><td></td></tr></table></td>
</tr>
<tr>
<td>Heredoc eval</td>
<td><table width="61.842105263158%" style="background: #0000FF"><tr><td></td></tr></table></td>
</tr>
<tr>
<td>Simple sprintf()</td>
<td><table width="87.938596491228%" style="background: #0000FF"><tr><td></td></tr></table></td>
</tr>
<tr>
<td>sprintf() with positional params</td>
<td><table width="100%" style="background: #0000FF;"><tr><td></td></tr></table></td>
</tr>
</table>
</blockquote>
<p>
I ran it multiple times, and this is pretty typical.  Apparently double quotes are actually faster than concatenating a bunch of variables with single-quoted literals.  How about that?  Heredoc format is usually pretty close, but sprintf() is always the slowest of the bunch.  Using sprintf() with positional parameters (like "%2$s") is always the slowest.
</p><p>
<i>Update 2008-05-02:</i> There have been multiple requests to see the code.  I forgot where I found the original basis, but that timer function is slightly magic to me, so I haven't touched it.  All the other stuff I modified to fit my own tests.  While I won't tell you where I stored it, or what I named it (I can just see the spammers hitting this over and over), here's what the code looks like:
</p>
<blockquote>
  <pre>
&lt;?php
set_time_limit(0);

@$getnumtimes = $_GET['numtimes'];
print("Argument was: $getnumtimes&lt;br /&gt;\n");
if (is_numeric($getnumtimes) and $getnumtimes &gt; 0 and $getnumtimes &lt; 1000000) {
print ("Argument was numeric&lt;br /&gt;\n");
    $numtimes = $getnumtimes;
} else {
print("Argument was invalid.&lt;br /&gt;\n");
    $numtimes = 1000;
}
$bgcolor = '#0000FF';

$data = 'This is data to be concatenated. It is long, so as to make it take longer to concatenate and hence widen the gap between the faster and the slower of the methods.';

$int = 1;
$float = 3.1415927;
$n = "\n";

$max = 1;

class timer
{
	var $_start;
	var $_current;
	function timer()
	{
		$this-&gt;_start = array_sum(explode(' ', microtime()));
	}
	function tick()
	{
		$this-&gt;_current = round((array_sum(explode(' ', microtime()))-$this-&gt;_start)*1000, 0);
		return $this-&gt;_current;
	}
	function reset()
	{
		$this-&gt;timer();
	}
}

print &lt;&lt;&lt;EOS
&lt;head&gt;
&lt;title&gt;PHP string formatting benchmark&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;p&gt;I'm working on some PHP right now, and I want it as fast as possible.  Naturally, I have to output some interesting stuff; concatenated strings, with integer or floating-point values in them.
&lt;/p&gt;&lt;p&gt;
The question becomes: is it faster to print values that must be formatted, such as the string "\\n", or integers or floating-point numbers, by:
&lt;/p&gt;&lt;p&gt;
&lt;ol&gt;
&lt;li&gt;Including them in one long double-quoted string&lt;/li&gt;
&lt;li&gt;Concatenating them between multiple single-quoted strings&lt;/li&gt;
&lt;li&gt;Using the heredoc format&lt;/li&gt;
&lt;li&gt;Using the sprintf() function&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;All calculations are done by putting the value into a variable, outstr.  Once the string is obtained, a simple print or echo can be used to output it.  This way I don't actually have to generate a lot of output in the HTML, so I can run the test online.
&lt;/p&gt;&lt;p&gt;
EOS;

print('calculating a very long string using only single-quote concatenation...');
$single_quote_timer = new timer();
for($i = 0; $i &lt; $numtimes; $i++) {
	$outstr = 'literal' . $n . $data . $int . $data . $float . $n;
}
$single_quote_timer = $single_quote_timer-&gt;tick();
if ($single_quote_timer &gt; $max) { $max = $single_quote_timer; }
print(' '.$single_quote_timer.'ms.&lt;br /&gt;');
$single_quote_outstr = $outstr;
//print("$single_quote_outstr&lt;br /&gt;&lt;br /&gt;\n");

print('calculating the same string using a large double-quoted concatenation...');
$double_quote_timer = new timer();
for($i = 0; $i &lt; $numtimes; $i++) {
	$outstr = "literal$n$data$int$data$float$n";
}
$double_quote_timer = $double_quote_timer-&gt;tick();
if ($double_quote_timer &gt; $max) { $max = $double_quote_timer; }
print(' '.$double_quote_timer.'ms.&lt;br /&gt;');
$double_quote_outstr = $outstr;
//print("$double_quote_outstr&lt;br /&gt;&lt;br /&gt;\n");

print('calculating the same string using a heredoc...');
$heredoc_timer = new timer();
for($i = 0; $i &lt; $numtimes; $i++) {
	$outstr =&lt;&lt;&lt;EOS
literal$n$data$int$data$float$n
EOS;
}
$heredoc_timer = $heredoc_timer-&gt;tick();
if ($heredoc_timer &gt; $max) { $max = $heredoc_timer; }
print(' '.$heredoc_timer.'ms.&lt;br /&gt;');
$heredoc_outstr = $outstr;
//print("$heredoc_outstr&lt;br /&gt;&lt;br /&gt;\n");

print('calculating the same string using an sprintf()...');
$sprintf_timer = new timer();
for($i = 0; $i &lt; $numtimes; $i++) {
	$outstr = sprintf('literal%s%s%d%s%f%s', $n, $data, $int, $data, $float, $n);
}
$sprintf_timer = $sprintf_timer-&gt;tick();
if ($sprintf_timer &gt; $max) { $max = $sprintf_timer; }
print(' '.$sprintf_timer.'ms.&lt;br /&gt;');
$sprintf_outstr = $outstr;
//print("$sprintf_outstr&lt;br /&gt;&lt;br /&gt;\n");

print('calculating the same string using an sprintf() with positional params...');
$pos_sprintf_timer = new timer();
for($i = 0; $i &lt; $numtimes; $i++) {
	$outstr = sprintf('literal%s%5$s%2$d%3$s%4$f%s', $n, $int, $data, $float, $data, $n);
}
$pos_sprintf_timer = $pos_sprintf_timer-&gt;tick();
if ($pos_sprintf_timer &gt; $max) { $max = $pos_sprintf_timer; }
print(' '.$pos_sprintf_timer.'ms.&lt;br /&gt;');
$pos_sprintf_outstr = $outstr;
//print("$pos_sprintf_outstr&lt;br /&gt;&lt;br /&gt;\n");

// Calculate percents
$single_quote_percent = ($single_quote_timer * 100)/$max;
$double_quote_percent = ($double_quote_timer * 100)/$max;
$heredoc_percent = ($heredoc_timer * 100)/$max;
$sprintf_percent = ($sprintf_timer * 100)/$max;
$pos_sprintf_percent = ($pos_sprintf_timer * 100)/$max;
print &lt;&lt;&lt;EOS
&lt;/p&gt;
&lt;h3&gt;Graphical comparisons&lt;/h3&gt;
&lt;p&gt;
&lt;table id="toptable" border="1"&gt;
&lt;tr&gt;&lt;th&gt;Method ($numtimes repetitions)&lt;/th&gt;&lt;th&gt;Percent of time out of max ($max ms)&lt;/th&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;Single quote concat&lt;/td&gt;&lt;td&gt;&lt;table width='$single_quote_percent%' style='background: $bgcolor'&gt;&lt;tr&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;Double quote eval&lt;/td&gt;&lt;td&gt;&lt;table width='$double_quote_percent%' style='background: $bgcolor'&gt;&lt;tr&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;Heredoc eval&lt;/td&gt;&lt;td&gt;&lt;table width='$heredoc_percent%' style='background: $bgcolor'&gt;&lt;tr&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;Simple sprintf()&lt;/td&gt;&lt;td&gt;&lt;table width='$sprintf_percent%' style='background: $bgcolor'&gt;&lt;tr&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;sprintf() with positional params&lt;/td&gt;&lt;td&gt;&lt;table width='$pos_sprintf_percent%' style='background: $bgcolor;'&gt;&lt;tr&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;
&lt;/p&gt;
EOS;

/*
print('&lt;hr /&gt;php version: '. phpversion()); 
print('&lt;br /&gt;php info: ');
phpinfo();
print('&lt;br /&gt;&lt;hr /&gt;');
*/
</pre>
</blockquote>
